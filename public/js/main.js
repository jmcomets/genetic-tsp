"use strict";var app=angular.module("app",["ngRoute"]);app.config(function($routeProvider){var partial=function(name){return"/partials/"+name+".html"};$routeProvider.when("/datasets/:name",{controller:"DatasetCtrl",templateUrl:partial("dataset")}).when("/home",{templateUrl:partial("home")}).otherwise({redirectTo:"/home"})}),app.controller("DatasetCtrl",function($scope,$routeParams){$scope.currentDataset=$routeParams.name,$scope.cities=$scope.datasets.citymaps[$scope.currentDataset],$scope.defaultBounds=function(){return{minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},$scope.updateBounds=function(){var bounds=$scope.defaultBounds();angular.forEach($scope.cities,function(city){(!bounds.minX||city.position.x<bounds.minX)&&(bounds.minX=city.position.x),(!bounds.minY||city.position.y<bounds.minY)&&(bounds.minY=city.position.y),(!bounds.maxX||city.position.x>bounds.maxX)&&(bounds.maxX=city.position.x),(!bounds.maxY||city.position.y>bounds.maxY)&&(bounds.maxY=city.position.y)}),bounds.width=bounds.maxX-bounds.minX,bounds.height=bounds.maxY-bounds.minY;var scale=.1;return bounds.minX-=bounds.width*scale,bounds.maxX+=bounds.width*scale,bounds.minY-=bounds.height*scale,bounds.maxY+=bounds.height*scale,bounds.width=bounds.maxX-bounds.minX,bounds.height=bounds.maxY-bounds.minY,bounds},$scope.bounds=$scope.updateBounds()}),app.controller("MainCtrl",function($scope,$location,APIService){APIService.configure().then(function(datasets){$scope.datasets=datasets}),$scope.isActive=function(viewLocation){return viewLocation==$location.path()}}),app.directive("vbox",function(){return{link:function(scope,element,attrs){attrs.$observe("vbox",function(value){element.attr("viewBox",value)})}}}),app.service("APIService",function($http,$q){return{configure:function(){var deferred=$q.defer();return $http.get("/api/config").success(function(data){deferred.resolve(data)}).error(function(){}),deferred.promise}}});